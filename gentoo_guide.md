# Установка Gentoo Linux + Arch + LiveCD + Haskell

Так уж сложилось, что я программирую на Haskell. И к сожалению нет ни одного LiveCD с готовой средой разработки на Haskell.
Поэтому я сделал свой собственный LiveCD. В качестве операционных систем я использую Gentoo Linux  и Arch Linux. Помимо создания LiveCD,  я подробно опишу процесс установки обеих операционных систем и затем мы приступим к их настройке и созданию LiveCD.

Это руководство написано для тех, кто хочет подробно разобраться в установке Gentoo Linux и  Arch Linux. Написано очень много замечательный программ, так что все и не охватить и существует огромное количество способов, сделать то или иное действие. В этом руководстве я постараюсь освятить подробно установку Gentoo + Arch, так как ее вижу я. И первый вопрос, почему Gentoo + Arch. Можно ведь было описать отдельно процесс установки Gentoo и отдельно процесс установки Arch. Это руководство именно о том, как использовать обе операционные системы одновременно. Приведу скриншот, того о чем идет речь.

![Gentoo Screenshots](https://github.com/hardentoo/gentoo_guide/blob/master/2017-11-23-073554_1920x1080_scrot.png)

Конечный результат должен быть таким

* установленный и настроенный Gentoo Linux (x86_64)
* установленный и настроенный Arch Linux (x86_64)
* возможность загрузить любую из операционок как xen dom0
* возможность загрузить вторую из операционок как xen domU
* возможность загрузить любую из операционок под lxc
* возможность одновремменно использовать программы из gentoo и arch
* установленная и настроенная среда разработки на haskell
* созданный LiveCD

Замечательно, теперь когда определелились с целями, давайте опишем как все это у нас будет работать.

* UEFI -> GRUB -> Xen -> Dom0 (Gentoo) -> LXC (Arch)

Почему в этой схеме Dom0 -> LXC. На самом деле работать будут все варианты. Я же привел тот, который использую чаще всего.
Вот другие

* UEFI -> GRUB -> Xen -> Dom0 (Arch) -> LXC (Gentoo)
* UEFI -> GRUB -> Xen -> Dom0 (Gentoo) -> DomU (Arch)
* UEFI -> GRUB -> Xen -> Dom0 (Arch) -> DomU (Gentoo)

Наша установка будет соответствовать всем этим вариантам одновременно. Устанавливать будем не спеша, по ходу дела настраивая системы. Опишем чуть больше подробностей.

* UEFI -> GRUB
   * grub версии 2, соберем его с поддержкой Crypto Luks и ZFS
* GRUB -> XEN
   * grub дешифрует корневую файловую систему, на которой расположено все (gentoo --- /boot + /  + /home и  arch --- /boot + / + /home)
   * файловая система ZFS. Почему ZFS? Посмотрите список [плюшек](https://wiki.gentoo.org/wiki/ZFS/Features)
   * грузится xen
   * будем по возможности использовать hardened профили и версии программ
* Xen -> Dom0
   * Если грузится gentoo dom0, то xen грузится тот который установлен в gentoo
   * Если грузится arch dom0, то xen грузится тот который установлен в arch

* После загрузки dom0, вы попадаете в соответствующую операционку и запускаете если хотите по желанию
   * либо xen domu со второй операционкой
   * либо lxc со второй операционкой

То есть у нас есть ровно 2 операционки, каждая из которых может быть загружена 3 способами, либо на физической машине, либо под xen, либо под lxc. Главное можно работать как в gentoo, так и в arch одноврмененно.

Теперь опишу как я буду настраивать среду разработки на haskell

* горячие клавиши мы повесим на все используя actkbd + xbindkeys (собранный с guile)
* менеджер окон --- мы будем использовать dwm (+ пачти) + dmenu (+ скрипты)
* терминал urxvt + скрипты на perl
* tmux + tmuxinator + плагины
* zsh (+zgen + плагины)
* vim + плагины

Собственно haskell
* ghc
* stack
* hoogle
* idris
* ...

Ну что поехали!

### Лучший способ стаить gentoo из под gentoo

Итак, чтобы установить gentoo нам необходима gentoo!


```bash
grub2-install --modules="linux crypto search_fs_uuid luks lvm" --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=gentoo --recheck --debug
```
